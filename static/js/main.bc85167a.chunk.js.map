{"version":3,"sources":["index.js"],"names":["CORS_PROXY","APP_ID","Mem","id","scr","texts","color","btn","i","ii","document","getElementById","innerHTML","canvas","ctx","getContext","img","Image","src","onload","height","width","drawImage","font","fillStyle","textAlign","fillText","text","x","y","this","write","new_texts","clearRect","lable","value","lll","length","max_size","nnn","words","split","n_words","count","j","new_string","k","undefined","inp","oninput","onclick","a","async","publishOnWall","toDataURL","start","load_mem","className","append","connect","send","readAllChunks","readableStream","reader","getReader","chunks","pump","read","then","done","push","fetchFileStream","fileAddress","filename","imgType","fetchStream","response","body","File","type","wallPhoto","authToken","method","params","access_token","data","v","serverToPhoto","uploadUrl","upload_url","request","FormData","fetch","json","server","photo","hash","res","photo_id","owner_id","message","attachments"],"mappings":"4OAOMA,EAAa,uCACbC,EAAS,QAmIf,SAASC,EAAIC,EAAIC,EAAKC,EAAOC,GAC5B,IAAD,OACQC,EAAK,GACT,IAAK,IAAIC,KAAKH,EAAO,CAErBE,GAAO,iBADHE,EAAKD,EAAI,EAAI,GACqBL,EAA/B,qCAITO,SAASC,eAAe,QAAQC,UAAY,uCACpBT,EADoB,8EAExCI,EAFwC,kBAGxBJ,EAHwB,gDAI1BA,EAJ0B,8GAM1C,IAAIU,EAASH,SAASC,eAAe,MAAQR,GACzCW,EAAMD,EAAOE,WAAW,MAExBC,EAAM,IAAIC,MACdD,EAAIE,IAAMd,EACVY,EAAIG,OAAS,WAKX,IAAK,IAAIX,KAJTK,EAAOO,OAASJ,EAAII,OACpBP,EAAOQ,MAAQL,EAAIK,MAEnBP,EAAIQ,UAAUN,EAAI,EAAE,GACNX,EACZS,EAAIS,KAAO,qBACXT,EAAIU,UAAYlB,EAChBQ,EAAIW,UAAY,SAChBX,EAAIY,SAASrB,EAAMG,GAAGmB,KAAMtB,EAAMG,GAAGoB,EAAGvB,EAAMG,GAAGqB,IAIrDC,KAAKC,MAAQ,SAAUC,GAGrB,IAAK,IAAIxB,KAFTM,EAAImB,UAAU,EAAG,EAAGpB,EAAOQ,MAAOR,EAAOO,QACzCN,EAAIQ,UAAUN,EAAI,EAAE,GACNX,EAAO,CAEnB,IAAI6B,EAAQF,EAAUxB,GAAG2B,MACrBC,EAAOF,EAAMG,OAEjB,GAAID,GAAO/B,EAAMG,GAAG8B,SAClBxB,EAAIS,KAAO,qBACXT,EAAIU,UAAYlB,EAChBQ,EAAIW,UAAY,SAChBX,EAAIY,SAASM,EAAUxB,GAAG2B,MAAO9B,EAAMG,GAAGoB,EAAGvB,EAAMG,GAAGqB,QAUtD,IAPA,IAAIU,EAAMH,EAAI/B,EAAMG,GAAG8B,SACnBE,EAAQN,EAAMO,MAAM,KACpBC,EAAUF,EAAMH,OAGhBM,EAAQ,EAEHC,EAAI,EAAGA,EAAIL,EAAKK,IAAK,CAK7B,IAJD,IAAIC,EAAa,GAIPC,EAAI,EAAGA,EAAIJ,EAAQH,EAAKO,SAEZC,GAAhBP,EAAMG,KACVE,GAAaL,EAAMG,GAAS,KAE5BA,IAYA7B,EAAIS,KAAO,qBACXT,EAAIU,UAAYlB,EAChBQ,EAAIW,UAAY,SAChBX,EAAIY,SAASmB,EAAYxC,EAAMG,GAAGoB,EAAGvB,EAAMG,GAAGqB,EAAI,GAAGe,MAS7D,IAAII,EAAM,GACV,IAAK,IAAIxC,KAAKH,EAAO,CACnB,IAAII,EAAKD,EAAI,EAAI,EACjBwC,EAAIxC,GAAKE,SAASC,eAAe,KAAOF,EAAUN,GAClD6C,EAAIxC,GAAG2B,MAAQ9B,EAAMG,GAAGmB,KACxBqB,EAAIxC,GAAGyC,QAAU,WACf,EAAKlB,MAAMiB,IAIPtC,SAASC,eAAe,MAAQR,GAEtC+C,QAAU,oBAAAC,EAAAC,OAAA,kEAAAD,EAAA,MAEJE,EAAcxC,EAAOyC,cAFjB,sCA4BH5C,SAASC,eAAe,OAASR,GACvC+C,QAAU,WACbK,KAIJ,SAASC,EAASrD,EAAIC,EAAKC,EAAOC,GAChC,IAKIU,GALAA,EAAM,IAAIC,OACVC,IAAMd,EACVY,EAAIyC,UAAY,UAChBzC,EAAIb,GAAK,UAAYA,EACrBO,SAASC,eAAe,QAAQ+C,OAAO1C,IACnCA,EAAON,SAASC,eAAe,UAAYR,IAC3C+C,QAAU,WACZ,IAAIhD,EAAIC,EAAIC,EAAKC,EAAOC,IAI5B,SAASiD,IACP7C,SAASC,eAAe,QAAQC,UAAY,GAC5C,IAAI4C,EAAS,EAAG,WAAY,CAAC,CAAC7B,KAAM,KAAMC,EAAG,IAAKC,EAAE,IAAKS,SAAU,GAAI,CAACX,KAAM,MAAOC,EAAG,IAAKC,EAAE,IAAKS,SAAU,IAAK,WACnH,IAAIkB,EAAS,EAAG,WAAY,CAAC,CAAC7B,KAAM,OAAQC,EAAG,IAAKC,EAAE,IAAKS,SAAU,KAAM,WAC3E,IAAIkB,EAAS,EAAG,WAAY,CAAC,CAAC7B,KAAM,UAAWC,EAAG,IAAKC,EAAE,IAAIS,SAAU,KAAM,WAzJ/EqB,IAAQC,KAAK,eAAgB,IAqK3BL,IACAI,IAAQC,KAAK,uBAAwB,CAAC,OAAU,QAAS,MAAU,mBA8BrE,IAAMC,EAAgB,SAACC,GACnB,IAAMC,EAASD,EAAeE,YACxBC,EAAS,GAWf,OATa,SAAPC,IACF,OAAOH,EAAOI,OAAOC,MAAK,YAAoB,IAAlBjC,EAAiB,EAAjBA,MACxB,OADyC,EAAVkC,KAEpBJ,GACXA,EAAOK,KAAKnC,GACL+B,QAIRA,IAUX,SAAeK,EAAgBC,EAAaC,EAAUC,GAAtD,SAAAvB,EAAAC,OAAA,yEACWuB,IAAYH,GACdJ,MAAK,SAAAQ,GAAQ,OAAIf,EAAce,EAASC,SACxCT,MAAK,SAAAH,GAAM,OAAI,IAAIa,KAAKb,EAAQQ,EAAU,CAACM,KAAML,QAH1D,qCAME,SAAerB,EAAc2B,GAA7B,qCAAA7B,EAAAC,OAAA,kEAAAD,EAAA,MAC8BQ,IAAQC,KAAK,uBAAwB,CACzD,OAAU3D,EACV,MAAS,YAHnB,cACYgF,EADZ,kBAAA9B,EAAA,MAKkCQ,IAAQC,KAAK,wBAAyB,CAC9DsB,OAAQ,6BACRC,OAAQ,CAACC,aAAcH,EAAUI,KAAKD,aAAcE,EAAG,WAPjE,cAKYC,EALZ,OASYC,EAAYD,EAAcF,KAAKT,SAASa,WACxCC,EAAU,IAAIC,SAV1B,KAWMD,EAXN,YAAAvC,EAAA,MAWoCoB,EAAgBS,EAAW,YAAa,cAX5E,gCAWctB,OAXd,UAWqB,QAXrB,kBAAAP,EAAA,MAY0CyC,MAAM5F,EAAawF,EAAW,CAC9DN,OAAQ,OACRL,KAAMa,IACPtB,MAAK,SAACQ,GAAD,OAAcA,EAASiB,WAfrC,wBAYaC,EAZb,EAYaA,OAAQC,EAZrB,EAYqBA,MAAOC,EAZ5B,EAY4BA,KAZ5B,YAAA7C,EAAA,MAgBwBQ,IAAQC,KAAK,wBAAyB,CACpDsB,OAAQ,uBACRC,OAAQ,CACJC,aAAcH,EAAUI,KAAKD,aAAcU,SAAQC,QAAOC,OAC1DV,EAAG,WApBjB,eAgBYW,EAhBZ,SAuBuCA,EAAIZ,KAAKT,SAAS,GAAxCsB,EAvBjB,EAuBa/F,GAAcgG,EAvB3B,EAuB2BA,SAvB3B,YAAAhD,EAAA,MAwBYQ,IAAQC,KAAK,0BAA2B,CAC1CwC,QAAQ,qIACRC,YAAY,QAAD,OAAUF,EAAV,YAAsBD,EAAtB,8BAAoDjG,MA1BzE,yC","file":"static/js/main.bc85167a.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport fetchStream from 'fetch-readablestream';\nimport './index.css';\n\nimport connect from '@vkontakte/vk-connect';\n\nconst CORS_PROXY = \"https://cors-anywhere.herokuapp.com/\";\nconst APP_ID = 7245851;\n\nfunction postResult(){\n    var xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", \"test_selected_category.php\", false);\n    xhr.setRequestHeader('Content-Type', \"URL\");\n    xhr.send(\"photo=\" + \"1\");\n    alert(\"anv: \" + xhr.responseText);\n   \n    \n}\n\n\nvar ACCESS_TOKEN, CANVAS_SEND;\n\n//connect.send('7245851'); \n\n/*\nconnect.subscribe((event) => {\n\n  const { type, data } = event.detail;\n\n  console.log(\"тип: \" +  type);\n  console.log(10);\n\n  if (type == \"VKWebAppAccessTokenReceived\") {\n    ACCESS_TOKEN = data.access_token;\n    //alert(ACCESS_TOKEN);\n  }\n  if (type == \"VKWebAppCallAPIMethodFailed\") {\n    //alert(data.error_data);\n    console.log(data.error_data);\n  }\n\n  /*\n  if (type == \"VKWebAppCallAPIMethodResult\") {\n\n    console.log(1);\n    console.log(data);\n    console.log(1);\n    if (data.request_id == \"mem\") {\n      alert(data.response.upload_url);\n\n      var ph = CANVAS_SEND.toDataURL();\n\n      /*\n      var xhr = new XMLHttpRequest();\n      xhr.open(\"POST\", \"test_selected_category.php\", false);\n      xhr.setRequestHeader('Content-Type', data.response.upload_url);\n      xhr.send(\"photo=\" + body );\n      alert(\"anv: \" + xhr.responseText);\n      */\n      /*\n\n      var xmlhttprequest = new XMLHttpRequest();\n\n      var boundary = \"------------\";\n\n      xmlhttprequest.open('POST', data.response.upload_url, false);\n      xmlhttprequest.setRequestHeader(\"Content-type\", \"multipart/form-data; boundary=\" + boundary);\n      var data_send = \n  \n      \"--\" + boundary + \"\\n\" + \n  \n    \n      \"Content-Disposition: form-data; name=\\\"file\\\"; filename=\\\"filename\\\"\\n\" + \n      \"Content-type: image/png\\n\\n\" +\n  \n  \n      body + \n  \n    \"\\n--\" + boundary + \"--\\n\"; \n\n    xmlhttprequest.send(data_send);\n\n    alert(xmlhttprequest.responseText);\n\n    \n    var data_ = {\n      photo: ph,\n    };\n\n    var boundary = String(Math.random()).slice(2);\n    var boundaryMiddle = '--' + boundary + '\\r\\n';\n    var boundaryLast = '--' + boundary + '--\\r\\n'\n\n    var body = ['\\r\\n'];\n    for (var key in data_) {\n      body.push('Content-Disposition: form-data; name=\"' + key + '\"\\r\\n\\r\\n' + data_[key] + '\\r\\n');\n    }\n\n    body = body.join(boundaryMiddle) + boundaryLast;\n\n    // Тело запроса готово, отправляем\n\n\n    var link = data.response.upload_url;\n    //link = link.replace('https', \"http\");\n    //alert (link);\n\n    var xhr = new XMLHttpRequest();\n    xhr.withCredentials = true;\n    xhr.open('POST', link, true);\n\n    xhr.setRequestHeader('Content-Type', 'multipart/form-data; boundary=' + boundary);\n\n    xhr.onreadystatechange = function() {\n      if (this.readyState != 4) return;\n\n      alert( this.responseText );\n    }\n\n    xhr.send(body);\n\n\n\n    }\n  \n\n  } \n \n  console.log(data);\n  //alert( \"type: \" + type);\n\n\n\n \n}); */\n\nconnect.send(\"VKWebAppInit\", {});\n\nfunction Mem(id, scr, texts, color)\n{\n    var btn =\"\";\n    for (var i in texts) {\n    var ii = i - 0 + 1;\n    btn+=  `<input id=\"in` + (ii) + \"\" + (id) + `\" type = \"text\" class = \"ctr_inp\">`;\n  }\n\n\n  document.getElementById(\"root\").innerHTML = \"<div class = 'mem' >\"\n    + `<input id=\"back` + id + `\" type = \"submit\" value=\"Назад\" class = \"ctr_inp\">`\n    + btn + \n    `<canvas id=\"cvs`+id+`\" class = \"cvs\"></canvas>\n    <input id=\"dvl`+id+`\" type = \"submit\" value=\"Отправить\" class = \"ctr_inp\"></div> \"`; \n\n    var canvas = document.getElementById(\"cvs\" + id);\n    var ctx = canvas.getContext('2d');\n\n    var img = new Image();\n    img.src = scr;\n    img.onload = () => {\n      canvas.height = img.height;\n      canvas.width = img.width;\n\n      ctx.drawImage(img,0,0);\n      for (var i in texts) {\n        ctx.font = \"bold  50px Verdana\";\n        ctx.fillStyle = color;\n        ctx.textAlign = \"center\";\n        ctx.fillText(texts[i].text, texts[i].x, texts[i].y);\n      }   \n    }\n\n    this.write = function (new_texts) {\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(img,0,0);\n      for (var i in texts) {\n\n        var lable = new_texts[i].value;\n        var lll =  lable.length;\n\n        if (lll <= texts[i].max_size) {\n          ctx.font = \"bold  50px Verdana\";\n          ctx.fillStyle = color;\n          ctx.textAlign = \"center\";\n          ctx.fillText(new_texts[i].value, texts[i].x, texts[i].y);\n        }\n        else {\n          var nnn = lll/texts[i].max_size;\n          var words = lable.split(\" \");\n          var n_words = words.length;\n   \n\n          var count = 0\n\n          for (var j = 0; j < nnn; j++) {\n          var new_string = \"\";\n\n\n\n           for (var k = 0; k < n_words/nnn; k++) {\n\n            if (words[count] != undefined)\n            new_string+= words[count] + \" \";\n            //console.log (Math.floor(j*n_words/nnn) + k);\n            count++;\n\n           } \n\n           //var newstr = new_string.split(\"undefined\"); \n           //new_string = \"\";\n\n           //for (var b = 0; b < newstr.length; b++) {\n           // new_string+=newstr[i] + \" \"; \n           //}\n\n\n            ctx.font = \"bold  50px Verdana\";\n            ctx.fillStyle = color;\n            ctx.textAlign = \"center\";\n            ctx.fillText(new_string, texts[i].x, texts[i].y + 40*j);           \n          }\n        }\n\n\n      }\n    }\n\n\n    var inp = [];\n    for (var i in texts) {\n      var ii = i - 0 + 1;\n      inp[i] = document.getElementById(\"in\" + ii + \"\" + id);\n      inp[i].value = texts[i].text;\n      inp[i].oninput = () =>{\n        this.write(inp);\n      }\n    }\n\n  var dvl = document.getElementById(\"dvl\" + id);\n\n  dvl.onclick = async ()=> {\n\n      await publishOnWall(canvas.toDataURL());\n    //CANVAS_SEND = canvas;\n    \n\n    //connect.send(\"VKWebAppShowWallPostBox\", {\"message\": \"Hello!\"});\n    //download(canvas, 'myimage.png');\n    \n    //ALERT();\n\n    //connect.send(\"VKWebAppCallAPIMethod\", {\"method\": \"users.get\", \"request_id\": \"32test\", \"params\": {\"user_ids\": \"1\", \"v\":\"5.103\", \"access_token\":\"your_token\"}});\n   /* connect.send(\"VKWebAppShowImages\", {\n      images: [\n        canvas.toDataURL(\"image/png;base64\"),\n      ]\n    });\n    */\n\n\n\n\n\n\n    //var s =  connect.send(\"VKWebAppCallAPIMethod\", {\"method\": \"photos.getWallUploadServer\", \"request_id\": \"mem\", \"params\": { \"v\":\"5.103\", \"access_token\":ACCESS_TOKEN}});\n    //alert(s);\n  }\n\n  var back = document.getElementById(\"back\" + id);\n  back.onclick = () =>{\n    start();\n  }\n}\n\nfunction load_mem(id, scr, texts, color){\n  var img = new Image();\n  img.src = scr;\n  img.className = \"mem_img\";\n  img.id = \"mem_img\" + id;\n  document.getElementById(\"root\").append(img);\n  var img =  document.getElementById(\"mem_img\" + id);\n  img.onclick = () => {\n    new Mem(id, scr, texts, color);\n  }\n}\n\nfunction start() {\n  document.getElementById(\"root\").innerHTML = \"\";\n  new load_mem(1, \"mem1.jpg\", [{text: \"No\", x: 700, y:100, max_size: 7}, {text: \"Yes\", x: 700, y:600, max_size: 7}], \"#000000\");\n  new load_mem(2, \"mem5.jpg\", [{text: \"Oyhh\", x: 350, y:350, max_size: 20}], \"#FFFFFF\");\n  new load_mem(3, \"mem6.jpg\", [{text: \"Lapotaa\", x: 350, y:350,max_size: 20}], \"#FFFFFF\");\n\n\n\n}\n\n\n\n\nfunction main()\n{\n\n  start();\n  connect.send(\"VKWebAppGetAuthToken\", {\"app_id\": 7245851, \"scope\":  \"friends,photos\"});\n}\n\nmain();\n\n\n\n\n\n// скаченая непонятная залупа \nfunction download(canvas, filename) {\n  var lnk = document.createElement('a'), e;\n  lnk.download = filename;\n  lnk.href = canvas.toDataURL(\"image/png;base64\");\n  if (document.createEvent) {\n    e = document.createEvent(\"MouseEvents\");\n    e.initMouseEvent(\"click\", true, true, window,\n                     0, 0, 0, 0, 0, false, false, false,\n                     false, 0, null);\n\n    lnk.dispatchEvent(e);\n  } else if (lnk.fireEvent) {\n    lnk.fireEvent(\"onclick\");\n  }\n}\n\n\n\n\n\nconst readAllChunks = (readableStream) => {\n    const reader = readableStream.getReader();\n    const chunks = [];\n\n    const pump = () => {\n        return reader.read().then(({value, done}) => {\n            if (done)\n                return chunks;\n            chunks.push(value);\n            return pump();\n        });\n    }\n\n    return pump();\n}\n\n\n\n \n\n\n\n\nasync function fetchFileStream(fileAddress, filename, imgType) {\n    return fetchStream(fileAddress)\n        .then(response => readAllChunks(response.body))\n        .then(chunks => new File(chunks, filename, {type: imgType}));\n}\n\n  async function publishOnWall(wallPhoto) {\n        const authToken = await connect.send(\"VKWebAppGetAuthToken\", {\n            \"app_id\": APP_ID,\n            \"scope\": \"photos\"\n        });\n        const serverToPhoto = await connect.send(\"VKWebAppCallAPIMethod\", {\n            method: \"photos.getWallUploadServer\",\n            params: {access_token: authToken.data.access_token, v: \"5.95\"}\n        });\n        const uploadUrl = serverToPhoto.data.response.upload_url;\n        const request = new FormData();\n        request.append(\"photo\", await fetchFileStream(wallPhoto, \"story.png\", 'image/png'));\n        const {server, photo, hash} = await fetch(CORS_PROXY + uploadUrl, {\n            method: \"POST\",\n            body: request\n        }).then((response) => response.json());\n        const res = await connect.send(\"VKWebAppCallAPIMethod\", {\n            method: \"photos.saveWallPhoto\",\n            params: {\n                access_token: authToken.data.access_token, server, photo, hash,\n                v: \"5.95\"\n            }\n        });\n        const {id: photo_id, owner_id} = res.data.response[0];\n        await connect.send(\"VKWebAppShowWallPostBox\", {\n            message: `Сообщение на стену с фото`,\n            attachments: `photo${owner_id}_${photo_id},https://vk.com/app${APP_ID}`\n        });\n    }"],"sourceRoot":""}