{"version":3,"sources":["index.js"],"names":["USER_ID","ACCESS_TOKEN","CORS_PROXY","APP_ID","Mem","id","scr","texts","color","size","btn","i","ii","document","getElementById","innerHTML","canvas","ctx","getContext","img","Image","src","onload","height","width","drawImage","font","fillStyle","textAlign","fillText","text","x","y","this","write","new_texts","clearRect","lable","value","lll","length","max_size","nnn","words","split","n_words","count","j","new_string","k","undefined","inp","oninput","dvl","onclick","a","async","remove","style","marginTop","publishOnWall","toDataURL","start","load_mem","className","append","_div","createElement","bottom","type","load_bottom","connect","subscribe","event","detail","data","access_token","console","log","error_data","request_id","alert","response","upload_url","replace","Promise","resolve","CANVAS_SEND","toBlob","imageBlob","formData","FormData","fetch","method","body","json","result","message","send","readAllChunks","readableStream","reader","getReader","chunks","pump","read","then","done","push","fetchFileStream","fileAddress","filename","imgType","fetchStream","File","wallPhoto","sendPromise","params","v","serverToPhoto","uploadUrl","request","server","photo","hash","res","photo_id","owner_id","attachments","photo_test","user_id","pub","_pub","str_id","items","group_ids","fields","sss","pub_adm_id","can_post","bt","name","rsp","n_m","sizes","String"],"mappings":"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","file":"static/js/main.f819dec3.chunk.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport fetchStream from 'fetch-readablestream';\nimport './index.css';\n\n\nimport connect from '@vkontakte/vk-connect';\n\nconst CORS_PROXY = \"https://cors-anywhere.herokuapp.com/\";\nconst APP_ID = 7245851;\nvar USER_ID;\n\nfunction postResult(){\n    var xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", \"test_selected_category.php\", false);\n    xhr.setRequestHeader('Content-Type', \"URL\");\n    xhr.send(\"photo=\" + \"1\");\n    alert(\"anv: \" + xhr.responseText);\n   \n    \n}\n\n\nvar ACCESS_TOKEN, CANVAS_SEND, PHOTO,ANSV_URL;\n\n//connect.send('7245851'); \n\n\nconnect.subscribe(async (event) =>  {\n\n  const { type, data } = event.detail;\n\n  \n  if (type == \"VKWebAppAccessTokenReceived\") {\n    ACCESS_TOKEN = data.access_token;\n    //alert(ACCESS_TOKEN);\n  }\n  if (type == \"VKWebAppCallAPIMethodFailed\") {\n    //alert(data.error_data);\n    console.log(data.error_data);\n  }\n\n  \n  if (type == \"VKWebAppCallAPIMethodResult\") {\n\n    ANSV_URL = data; \n\n    console.log(1);\n    console.log(data);\n    console.log(1);\n    if (data.request_id == \"mem\") {\n      alert(data.response.upload_url);\n\n\n      var upload_url = data.response.upload_url;\n\n\n      var link = upload_url.replace(\"https://\", \"\");\n\n\n\n      \n      let imageBlob = await new Promise(resolve => CANVAS_SEND.toBlob(resolve, 'image/png'));\n\n      let formData = new FormData();\n      //formData.append(\"firstName\", \"John\");\n      formData.append(\"photo\", imageBlob, \"image.png\");\n\n      let response = await fetch(CORS_PROXY + upload_url, {\n        method: 'POST',\n        body: formData\n      });\n      let result = await response.json();\n      alert(result.message);\n\n\n\n      \n    }\n\n\n\n\n    }\n  \n\n  \n \n  console.log(data);\n  //alert( \"type: \" + type);\n\n\n \n \n}); \n\nconnect.send(\"VKWebAppInit\", {});\n\nfunction Mem(id, scr, texts, color, size)\n{\n    var btn =\"\";\n    for (var i in texts) {\n    var ii = i - 0 + 1;\n    btn+=  `<input id=\"in` + (ii) + \"\" + (id) + `\" type = \"text\" class = \"ctr_inp\">`;\n  }\n\n\n  document.getElementById(\"root\").innerHTML = \"<div class = 'mem' >\"\n    + `<input id=\"back` + id + `\" type = \"submit\" value=\"Назад\" class = \"ctr_inp\">`\n    + btn + \n    `<canvas id=\"cvs`+id+`\" class = \"cvs\"></canvas>\n    <input id=\"dvl`+id+`\" type = \"submit\" value=\"Отправить\" class = \"ctr_inp\"></div>`; \n\n    var canvas = document.getElementById(\"cvs\" + id);\n    var ctx = canvas.getContext('2d');\n\n    var img = new Image();\n    img.src = scr;\n    img.onload = () => {\n      canvas.height = img.height;\n      canvas.width = img.width;\n\n      ctx.drawImage(img,0,0);\n      for (var i in texts) {\n        ctx.font = \"bold  \" +size +\"px Verdana\";\n        ctx.fillStyle = color;\n        ctx.textAlign = \"center\";\n        ctx.fillText(texts[i].text, texts[i].x, texts[i].y);\n      }   \n    }\n\n    this.write = function (new_texts) {\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(img,0,0);\n      for (var i in texts) {\n\n        var lable = new_texts[i].value;\n        var lll =  lable.length;\n\n        if (lll <= texts[i].max_size) {\n          ctx.font = \"bold  \" +size +\"px Verdana\";\n          ctx.fillStyle = color;\n          ctx.textAlign = \"center\";\n          ctx.fillText(new_texts[i].value, texts[i].x, texts[i].y);\n        }\n        else {\n          var nnn = lll/texts[i].max_size;\n          var words = lable.split(\" \");\n          var n_words = words.length;\n   \n\n          var count = 0\n\n          for (var j = 0; j < nnn; j++) {\n          var new_string = \"\";\n\n\n\n           for (var k = 0; k < n_words/nnn; k++) {\n\n            if (words[count] != undefined)\n            new_string+= words[count] + \" \";\n            //console.log (Math.floor(j*n_words/nnn) + k);\n            count++;\n\n           } \n\n\n\n            ctx.font = \"bold  \" +size +\"px Verdana\";\n            ctx.fillStyle = color;\n            ctx.textAlign = \"center\";\n            ctx.fillText(new_string, texts[i].x, texts[i].y + size*j);           \n          }\n        }\n\n\n      }\n    }\n\n\n    var  inp = [];\n    for (var i in texts) {\n      var ii = i - 0 + 1;\n      inp[i] = document.getElementById(\"in\" + ii + \"\" + id);\n      inp[i].value = texts[i].text;\n      inp[i].oninput = () =>{\n        this.write(inp);\n      }\n    }\n\n  var dvl = document.getElementById(\"dvl\" + id);\n\n  dvl.onclick = async ()=> {\n   \n   for ( var i in inp) inp[i].remove();\n\n    canvas.style.marginTop = \"20px\";\n\n    dvl.value = \"Генерация мема ...\"\n    dvl.onclick = null;\n    await publishOnWall(canvas.toDataURL(), dvl);\n\n\n\n    dvl.value = \"Отправить в диалог\"\n\n  }\n\n  var back = document.getElementById(\"back\" + id);\n  back.onclick = () =>{\n    start();\n  }\n}\n\n\n\nfunction blobToFile(theBlob, fileName){\n    //A Blob() is almost a File() - it's just missing the two properties below which we will add\n    theBlob.lastModifiedDate = new Date();\n    theBlob.name = fileName;\n    return theBlob;\n}\n\n\nfunction load_mem(id, scr, texts, color, size){\n  var img = new Image();\n  img.src = scr;\n  img.className = \"mem_img\";\n  img.id = \"mem_img\" + id;\n  document.getElementById(\"mem_list\").append(img);\n  var img =  document.getElementById(\"mem_img\" + id);\n  img.onclick = () => {\n    new Mem(id, scr, texts, color, size);\n  }\n}\n\nfunction load_line()\n{\n  var html = \"<div class = 'line_lable' ><a  class = 'href'  href='https://vk.com/public189857738'>Go в Мемницу</a>  </div>  <div class = 'line_line' > <input type  = 'button' class = 'btn_btn' value = 'Новинки' id='kt1'> <input id='kt2' type  = 'button' class = 'btn_btn' value = 'Известные'>  <input id='kt3' type  = 'button' class = 'btn_btn' value = 'Баяны'> </div>\"\n  document.getElementById(\"root\").innerHTML = html ;\n  document.getElementById(\"kt1\").onclick = ()=> {\n\n    document.getElementById(\"kt1\").className = \"btn_select\";\n    document.getElementById(\"kt2\").className = \"btn_btn\";\n    document.getElementById(\"kt3\").className = \"btn_btn\";\n\n\n\n    document.getElementById(\"mem_list\").innerHTML = \"\";\n    new load_mem(5, \"mem8.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#FFFFFF\", 50);\n    new load_mem(2, \"mem5.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#FFFFFF\", 50);\n    new load_mem(3, \"mem6.jpg\", [{text: \"Lapotaa\", x: 350, y:300,max_size: 20}], \"#FFFFFF\", 50);\n    new load_mem(1, \"mem1.jpg\", [{text: \"No\", x: 700, y:100, max_size: 7}, {text: \"Yes\", x: 700, y:600, max_size: 7}], \"#000000\", 50);\n\n  }\n  document.getElementById(\"kt2\").onclick = ()=> {\n\n    document.getElementById(\"kt1\").className = \"btn_btn\";\n    document.getElementById(\"kt2\").className = \"btn_select\";\n    document.getElementById(\"kt3\").className = \"btn_btn\";\n\n    document.getElementById(\"mem_list\").innerHTML = \"\";\n\n    \n    new load_mem(5, \"mem8.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#FFFFFF\", 50);\n    new load_mem(6, \"mem9.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#000000\", 50);\n    new load_mem(7, \"mem10.jpg\", [{text: \"Oyhh\", x: 1000, y:1000, max_size: 20}], \"#FFFFFF\", 100);\n    new load_mem(4, \"mem7.jpg\", [{text: \"No\", x: 150, y:60, max_size: 7}, {text: \"Yes\", x: 150, y:150, max_size: 7}], \"#000000\", 10);   \n  }\n  document.getElementById(\"kt3\").onclick = ()=> {\n\n\n    document.getElementById(\"kt1\").className = \"btn_btn\";\n    document.getElementById(\"kt2\").className = \"btn_btn\";\n    document.getElementById(\"kt3\").className = \"btn_select\";\n\n    document.getElementById(\"mem_list\").innerHTML = \"\";\n    new load_mem(2, \"mem5.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#FFFFFF\", 50);\n    new load_mem(3, \"mem6.jpg\", [{text: \"Lapotaa\", x: 350, y:300,max_size: 20}], \"#FFFFFF\", 50);\n \n    new load_mem(5, \"mem8.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#FFFFFF\", 50);\n    new load_mem(6, \"mem9.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#000000\", 50);\n    new load_mem(7, \"mem10.jpg\", [{text: \"Oyhh\", x: 1000, y:1000, max_size: 20}], \"#FFFFFF\", 100);  \n  }\n}\n\nfunction load_bottom() {\n   var bottom = document.createElement(\"input\");\n  bottom.className = \"bottom_input\";\n  bottom.id = \"bottom_input\";\n  bottom.type = \"button\";\n  bottom.value  = \"Свой шаблон\"\n  document.getElementById(\"root\").append(bottom);\n}\n\nfunction start() {\n  document.getElementById(\"root\").innerHTML = \"\";\n\n\n\n  load_line();\n\n\n  var _div = document.createElement(\"div\");\n  _div.className = \"mem_list\";\n  _div.id = \"mem_list\";\n  document.getElementById(\"root\").append(_div);\n\n  load_bottom();\n\n  \n  new load_mem(2, \"mem5.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#FFFFFF\", 50);\n  new load_mem(3, \"mem6.jpg\", [{text: \"Lapotaa\", x: 350, y:300,max_size: 20}], \"#FFFFFF\", 50);\n  new load_mem(1, \"mem1.jpg\", [{text: \"No\", x: 700, y:100, max_size: 7}, {text: \"Yes\", x: 700, y:600, max_size: 7}], \"#000000\", 50);\n  new load_mem(4, \"mem7.jpg\", [{text: \"No\", x: 150, y:60, max_size: 7}, {text: \"Yes\", x: 150, y:150, max_size: 7}], \"#000000\", 10);\n  new load_mem(5, \"mem8.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#FFFFFF\", 50);\n  new load_mem(6, \"mem9.jpg\", [{text: \"Oyhh\", x: 350, y:300, max_size: 20}], \"#000000\", 50);\n  new load_mem(7, \"mem10.jpg\", [{text: \"Oyhh\", x: 1000, y:1000, max_size: 20}], \"#FFFFFF\", 100);\n\n\n}\n\n\n\n\nfunction main()\n{\n\n  start();\n  connect.send(\"VKWebAppGetAuthToken\", {\"app_id\": 7245851, \"scope\":  \"friends,photos,groups\"});\n}\n\nmain();\n\n\n\n\n\n// скаченая непонятная залупа \nfunction download(canvas, filename) {\n  var lnk = document.createElement('a'), e;\n  lnk.download = filename;\n  lnk.href = canvas.toDataURL(\"image/png;base64\");\n  if (document.createEvent) {\n    e = document.createEvent(\"MouseEvents\");\n    e.initMouseEvent(\"click\", true, true, window,\n                     0, 0, 0, 0, 0, false, false, false,\n                     false, 0, null);\n\n    lnk.dispatchEvent(e);\n  } else if (lnk.fireEvent) {\n    lnk.fireEvent(\"onclick\");\n  }\n}\n\n\n\n\n\nconst readAllChunks = (readableStream) => {\n    const reader = readableStream.getReader();\n    const chunks = [];\n\n    const pump = () => {\n        return reader.read().then(({value, done}) => {\n            if (done)\n                return chunks;\n            chunks.push(value);\n            return pump();\n        });\n    }\n\n    return pump();\n}\n\n\n\n \n\n\n\n\nasync function fetchFileStream(fileAddress, filename, imgType) {\n    return fetchStream(fileAddress)\n        .then((response) => readAllChunks(response.body))\n        .then((chunks) => new File(chunks, filename, {type: imgType}));\n}\n\n  async function publishOnWall(wallPhoto, dvl) {\n        const authToken = await connect.sendPromise(\"VKWebAppGetAuthToken\", {\n            \"app_id\": APP_ID,\n            \"scope\":  \"friends,photos,groups\"\n        })\n\n        \n\n        const serverToPhoto = await connect.sendPromise(\"VKWebAppCallAPIMethod\", {\n            method: \"photos.getWallUploadServer\",\n            params: {access_token: ACCESS_TOKEN, v: \"5.95\"}\n        });\n\n        \n\n        console.log(\"tophoto\" + serverToPhoto);\n        console.log(serverToPhoto);\n\n        const uploadUrl = serverToPhoto.response.upload_url;\n        const request = new FormData();\n\n        request.append(\"photo\", await fetchFileStream(wallPhoto, \"story.png\", 'image/png'));\n\n        const {server, photo, hash} = await fetch(CORS_PROXY + uploadUrl, {\n            method: \"POST\",\n            body: request\n        }).then((response) => response.json());\n\n        console.log(photo);\n\n\n        const res = await connect.sendPromise(\"VKWebAppCallAPIMethod\", {\n            method: \"photos.saveWallPhoto\",\n            params: {\n                access_token: ACCESS_TOKEN, server, photo, hash,\n                v: \"5.95\"\n            }\n        })\n        console.log(\"res: \" + res);\n        console.log(res);\n        var {id: photo_id, owner_id} = res.response[0];\n\n        USER_ID = owner_id;\n\n\n        var photo_test = await connect.sendPromise(\"VKWebAppShowWallPostBox\", {\n            message: ``,\n            attachments: `photo${owner_id}_${photo_id}`,\n            owner_id: -189879960,\n\n        });\n\n\n        console.log(\"res: \" + photo_test);\n        console.log(photo_test);\n\n\n      \n          var bottom = document.createElement(\"input\");\n          bottom.className = \"bottom_input\";\n          bottom.id = \"share\";\n          bottom.type = \"button\";\n          bottom.value  = \"Отправить в сообщество\";\n          document.getElementById(\"root\").append(bottom);\n\n\n          bottom.onclick =  async() => {\n              \n\n            var pub = await connect.sendPromise(\"VKWebAppCallAPIMethod\", {\n               method: \"groups.get\",\n               params: {access_token: ACCESS_TOKEN, v: \"5.95\", user_id: USER_ID},\n               user_id: USER_ID,\n            });\n\n            console.log(pub);\n           \n\n            var _pub = [];\n            var str_id = \"\";\n\n            for (var i in pub.response.items) {\n              str_id+= pub.response.items[i] + \",\";\n\n            }\n\n\n              console.log(\"pub.response\");\n              console.log(pub.response);\n\n              \n              console.log(\"pub.response.items\");\n              console.log(pub.response.items);\n\n\n              console.log(str_id);\n\n            \n              _pub = await connect.sendPromise(\"VKWebAppCallAPIMethod\", {\n                  group_ids: str_id,\n                  method: \"groups.getById\",\n                  params: {access_token: ACCESS_TOKEN, v: \"5.95\", group_ids: str_id, fields: \"can_post\"},\n                  \n              });\n               console.log(_pub);\n\n\n               var sss = _pub.response;\n\n\n               console.log(\"_pub.response\");\n               console.log(_pub.response);\n              \n            var pub_adm_id = [];\n           \n                for (var i in sss) {\n                  if (sss[i].can_post == 1) pub_adm_id.push(sss[i]);\n                }\n\n\n\n\n             \n\n            for (var i  in pub_adm_id ) {\n              var bt = document.createElement(\"input\");\n              bt.className = \"bottom_input\";\n              bt.type = \"button\";\n\n               bt.value  = pub_adm_id[i].name;\n              document.getElementById(\"root\").append(bt);\n\n              bt.onclick = async()=> {\n\n\n                      var photo_test = await connect.sendPromise(\"VKWebAppShowWallPostBox\", {\n                        message: ``,\n                        owner_id: -pub_adm_id[i].id,\n                        attachments: `photo${owner_id}_${photo_id}`\n                      });\n\n\n\n                        //connect.send(\"VKWebAppShowWallPostBox\", {\"message\": \"Hello!\"});\n\n\n                      // connect.sendPromise(\"VKWebAppCallAPIMethod\", {\n                        //method: \"wall.post\",\n                        //params: {access_token: ACCESS_TOKEN, v: \"5.95\", owner_id: pub_adm_id[i].id, friends_only: 0, from_group: 0,  message:\"\", attachments: `photo${owner_id}_${photo_id}`}\n                   // });\n                            \n              }\n\n            }\n            \n              \n          }\n\n\n\n\n          dvl.onclick = () => {\n\n            var rsp = res.response[0];\n            console.log(rsp);\n            var n_m = res.response[0].sizes[res.response[0].sizes.length-1];\n            console.log(n_m);\n\n\n            console.log(\"https://vk.com/photo\" + owner_id + \"_\" + photo_id);\n\n            //alert(\"https://vk.com/photo\" + owner_id + \"_\" + photo_id);\n\n\n              owner_id = String(owner_id);\n              owner_id = owner_id.replace(\" \", \"\");\n              photo_id = String(photo_id);\n              photo_id = photo_id.replace(\" \", \"\");\n\n             // alert(photo_id);\n\n            connect.send(\"VKWebAppShare\", {\"link\": \"https://vk.com/photo\" + owner_id + \"_\" + photo_id});\n          }\n           \n\n\n\n\n    }"],"sourceRoot":""}